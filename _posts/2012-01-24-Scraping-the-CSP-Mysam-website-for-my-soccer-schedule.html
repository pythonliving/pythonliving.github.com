---
layout: post
title: Scraping the CSP Mysam website for my soccer schedule
tags: 
 - 2012
 - Programming
 - CSP Schedule Converter
---

<p>&nbsp;</p>
<div style="background-color: transparent;"><strong id="internal-source-marker_0.3583032034803182"><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Yesterday I published my first Chrome Extension. &nbsp;This extension collects the game schedule data from the Mysam account of our local Indoor Sports Park and creates a button called &lsquo;Download Calendar&rsquo;. &nbsp;Once you click on the button it brings you to a popup that provides you with the option to select your calendar type and it then provides you with either a csv or ics file that you can import into the Calendar type of your choosing.</span><br /><br /><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">One of the first things I had to do, when starting this project, was scrape the information from the page. &nbsp;Scraping, in this context, means simply identifying what information I want, where it&rsquo;s stored, and then collecting it together in some fashion. &nbsp;Identifying where the code is stored can sometimes be the most difficult part of the scraping process. &nbsp;How long this takes is highly dependent on how well the site is put together. &nbsp;</span><br /><br /><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">Luckily the CSP website was fairly well put together, so it wasn&rsquo;t that difficult to do. &nbsp;First off I created a function to house all this information. &nbsp;I called it </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">collectschedule()</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, as is appropriate. &nbsp;</span><br /><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">function collectschedule (){</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;var name = $j(".header")[0].innerText;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;var teamname = name.slice(5)</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;var scheduletable = $j(".table-data")[0];</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;var totalrows = scheduletable.children[0].childElementCount;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;var finalschedule = [];</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;var game = 1;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;for (var rownumber = 1; rownumber &lt; totalrows; rownumber += 2){</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;var schedule = {};</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;var tablerows = scheduletable['children'][0];</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;var tablerow = tablerows.children[rownumber];</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;var datetime = tablerow.children[0].innerText;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;var comp = tablerow.children[2].innerText;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;var tshirt = tablerow.children[2].innerHTML;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;var tshirtcolor = "- Home";</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;if (tshirt.indexOf("&lt;") != 0){</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var tshirtcolor = "- Away"</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;};</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;if (tshirtcolor == "- Away"){</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comp = comp.slice(3)</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;};</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;datetime = adjustdate(datetime);</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;schedule['game'] = game;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;schedule['datetime'] = datetime;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;schedule['competitor'] = comp;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;schedule['tshirtcolor'] = tshirtcolor;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;schedule['teamname'] = teamname;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;finalschedule.push(schedule);</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;&nbsp;&nbsp;game = game + 1;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;};</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;console.log( finalschedule );</span><br /><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;return finalschedule;</span><br /><span style="font-size: 12px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">};</span><br /><br /><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">This functions starts out by setting a bunch of variables. &nbsp;The first one, </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">name</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, is the first element in the list of elements with class </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">header, </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">and for programming that means position zero. &nbsp;The position is designated by the zero in brackets. &nbsp;Class is designated by the &lsquo;</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">.</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">&rsquo; and as with all javascript the variable is first indicated with the </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">var</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> in the beginning. &nbsp;The variable </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">name</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> equates to the first line &lsquo;Team *team name*&rsquo;. &nbsp;&nbsp;The second variable is that same line, but sliced apart so it only includes *team name*. &nbsp;Then I create a variable that identifies the table where the schedule is included (</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">scheduletable</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">), the total rows in the table (</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">tablerows</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">), an empty list called </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">finalschedule</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> and a base variable called </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">game</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. &nbsp;The last variable </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">game</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">, is used to identify which game of the season is being played.</span><br /><br /><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">The most important data to collect is what is up next, the actual schedule. &nbsp;The schedule is in a table, with each table&rsquo;s section filled with the appropriate information. &nbsp;In order to collect this information correctly, I made a </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">for</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> loop that would go through each line in the table and collect the necessary data. &nbsp;Each line&rsquo;s data is then put into it&rsquo;s own dictionary. &nbsp;Then, after each line is collected, that small dictionary is added to the empty list </span><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">finalschedule</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;">. &nbsp;</span><br /><br /><span style="font-size: 15px; font-family: Arial; background-color: transparent; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">Up next time: A continuation of my for loop in the collectschedule() function</span><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> &nbsp;</span><br /><br /><br /><span style="font-size: 15px; font-family: Arial; background-color: transparent; font-weight: normal; text-decoration: none; vertical-align: baseline; white-space: pre-wrap;"> </span></strong></div>
<p>&nbsp;</p>